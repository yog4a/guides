# This is the sshd server system-wide configuration file.
# See sshd_config(5) for more information.

# Include any additional configuration files
Include /etc/ssh/sshd_config.d/*.conf

# --------------------------------------------------------------------
# Network & Protocol Settings
# --------------------------------------------------------------------
Protocol 2
Port 22
AddressFamily inet

# --------------------------------------------------------------------
# Host Keys
# --------------------------------------------------------------------
HostKey /etc/ssh/ssh_host_ed25519_key

# --------------------------------------------------------------------
# Logging
# --------------------------------------------------------------------
SyslogFacility AUTH
LogLevel VERBOSE

# --------------------------------------------------------------------
# Authentication Settings
# --------------------------------------------------------------------
LoginGraceTime 30                     # Allow 30 seconds for authentication
PermitRootLogin no                    # Disable direct root logins
StrictModes yes                       # Check file permissions of user's files before accepting login
PermitEmptyPasswords no               # Disallow accounts with empty passwords

# Restrict SSH access to specific users:
AllowUsers XXXXXXXXXX                     # Only allow user to log in

# Session Settings
MaxAuthTries 3                        # Limit the number of authentication attempts per connection
MaxSessions 2                         # Limit the number of concurrent sessions per connection

# Force public key authentication and disable other methods:
AuthenticationMethods publickey       # Force use of public key authentication
PubkeyAuthentication yes              # Enable public key authentication
PasswordAuthentication no             # Disable password-based logins
ChallengeResponseAuthentication no    # Disable challenge-response authentication
KbdInteractiveAuthentication no       # Disable keyboard-interactive authentication

# --------------------------------------------------------------------
# Authorized Keys & Host-based Authentication
# --------------------------------------------------------------------
AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2
HostbasedAuthentication no            # Disable host-based authentication
IgnoreUserKnownHosts no               # Do not ignore user's known hosts
IgnoreRhosts yes                      # Do not trust .rhosts files

# --------------------------------------------------------------------
# PAM (Pluggable Authentication Modules)
# --------------------------------------------------------------------
UsePAM yes                            # Enable PAM authentication

# --------------------------------------------------------------------
# X11 and Display Settings
# --------------------------------------------------------------------
X11Forwarding no                       # Disable X11 forwarding

# --------------------------------------------------------------------
# Miscellaneous Options
# --------------------------------------------------------------------
PrintMotd no                           # Disables the printing of the Message of the Day upon login.
TCPKeepAlive yes                       # Keeps TCP connections alive; this can help detect dead connections.
UseDNS no                              # Disables DNS reverse lookup on connecting clients, which speeds up authentication and reduces spoofing risks.
AcceptEnv LANG LC_*                    # Allows clients to pass locale-related environment variables

# --------------------------------------------------------------------
# Connection Timeouts
# --------------------------------------------------------------------
ClientAliveInterval 300                # Send keepalive messages every 300 seconds
ClientAliveCountMax 0                  # Do not terminate the connection after a single keepalive message

# --------------------------------------------------------------------
# Subsystem
# --------------------------------------------------------------------
Subsystem sftp /usr/lib/openssh/sftp-server

# --------------------------------------------------------------------
# Additional Hardening Directives (Custom)
# --------------------------------------------------------------------
PermitUserEnvironment no              # Prevent users from setting custom environment variables
AllowAgentForwarding no               # Disable SSH agent forwarding to protect private keys
DebianBanner no                       # Hide Debian-specific version information
Banner none                           # Disable the display of a banner message